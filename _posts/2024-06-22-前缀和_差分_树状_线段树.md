---
title: "æ•°æ®ç»“æ„ï¼šå‰ç¼€å’Œæ•°ç»„/å·®åˆ†æ•°ç»„/æ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘"
categories: [ds-algo]

math: true
layout: post
---

> æœ¬æ–‡å±äº **æ•°æ®ç»“æ„ç³»åˆ—åšå®¢**ã€‚æœ¬ç³»åˆ—æ—¨åœ¨ç³»ç»Ÿæ¢³ç†å¸¸è§æ•°æ®ç»“æ„çš„åŸç†ã€å®ç°ä¸åº”ç”¨ï¼Œé€‚åˆåˆ·é¢˜ã€é¢è¯•åŠæ•™å­¦ä½¿ç”¨ã€‚

ğŸ”— **ç›®å½•å¯¼èˆªï¼š**
- [å‰ç¼€å’Œæ•°ç»„](/posts/å‰ç¼€å’Œ_å·®åˆ†_æ ‘çŠ¶_çº¿æ®µæ ‘/#å‰ç¼€å’Œæ•°ç»„)
- [å·®åˆ†æ•°ç»„](/posts/å‰ç¼€å’Œ_å·®åˆ†_æ ‘çŠ¶_çº¿æ®µæ ‘/#å·®åˆ†æ•°ç»„)
- [é˜Ÿåˆ—/æ ˆ](/posts/æ ˆ_é˜Ÿåˆ—_å•è°ƒæ ˆ_å †/#é˜Ÿåˆ—å’Œæ ˆ)
- [å•è°ƒæ ˆ](/posts/æ ˆ_é˜Ÿåˆ—_å•è°ƒæ ˆ_å †/#å•è°ƒæ ˆ)
- [å †(ä¼˜å…ˆçº§é˜Ÿåˆ—)](/posts/æ ˆ_é˜Ÿåˆ—_å•è°ƒæ ˆ_å †/#å †ä¼˜å…ˆçº§é˜Ÿåˆ—)
- [æ ‘çŠ¶æ•°ç»„](/posts/å‰ç¼€å’Œ_å·®åˆ†_æ ‘çŠ¶_çº¿æ®µæ ‘/#æ ‘çŠ¶æ•°ç»„)
- [çº¿æ®µæ ‘](/posts/å‰ç¼€å’Œ_å·®åˆ†_æ ‘çŠ¶_çº¿æ®µæ ‘/#çº¿æ®µæ ‘)
- [å¹¶æŸ¥é›†](/posts/å­—å…¸æ ‘_LRU_å¹¶æŸ¥é›†/#å¹¶æŸ¥é›†)
- [å­—å…¸æ ‘](/posts/å­—å…¸æ ‘_LRU_å¹¶æŸ¥é›†/#å­—å…¸æ ‘)
- [LRU(æœ€è¿‘æœ€å°‘ä½¿ç”¨)](/posts/å­—å…¸æ ‘_LRU_å¹¶æŸ¥é›†/#lru)

---

## å‰ç¼€å’Œæ•°ç»„

**å‰ç¼€å’Œæ•°ç»„**ï¼ˆPrefix Sum Arrayï¼‰æ˜¯ç®—æ³•ä¸­ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„æŠ€å·§ï¼Œå¸¸ç”¨äºé«˜æ•ˆåœ°å¤„ç†**åŒºé—´æ±‚å’Œ**ç­‰é—®é¢˜ã€‚

### è®¾è®¡æ€è·¯

ç»™å®šä¸€ä¸ªæ•°ç»„ `nums`ï¼Œå…¶å‰ç¼€å’Œæ•°ç»„ `prefix` çš„å®šä¹‰å¦‚ä¸‹ï¼š

```python
prefix[0] = 0
prefix[i] = nums[0] + nums[1] + ... + nums[i-1]  # ä»i=1å¼€å§‹
```

ä¹Ÿå°±æ˜¯è¯´ï¼š

```python
prefix[i] = prefix[i-1] + nums[i-1]
```

è¿™æ ·ï¼Œä»»ä½•åŒºé—´ `[l, r]` çš„å’Œå¯ä»¥é€šè¿‡ï¼š

```python
sum(l, r) = prefix[r+1] - prefix[l]
```

ç›´æ¥æš´åŠ›æ±‚åŒºé—´ `[l, r]` çš„å’Œï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(r - l + 1)ï¼Œè€Œå‰ç¼€å’Œå°†å…¶ä¼˜åŒ–ä¸º O(1)ï¼Œåœ¨æœ‰å¤§é‡åŒºé—´æ±‚å’Œçš„æƒ…å†µä¸‹æ•ˆç‡æé«˜ã€‚

> ä¸ºå•¥å‰ç¼€å’Œæ•°ç»„é•¿åº¦ä¸º`n+1`å‘¢ï¼Ÿ
> 
> ä¸ºäº†ç»Ÿä¸€åŒºé—´å’Œçš„è®¡ç®—å…¬å¼ï¼Œæ–¹ä¾¿å¤„ç† [0, r] å’Œ [l, r] è¿™ç§ä»ä»»æ„ä½ç½®å¼€å§‹çš„åŒºé—´

**å¸¸è§åº”ç”¨åœºæ™¯ï¼š**

| åœºæ™¯            | è¯´æ˜                |
| ------------- | ----------------- |
| åŒºé—´å’ŒæŸ¥è¯¢         | å¤šæ¬¡æŸ¥è¯¢ `[l, r]` åŒºé—´å’Œ |
| å­æ•°ç»„å’Œç›¸å…³é—®é¢˜      | å¦‚â€œå’Œä¸º K çš„å­æ•°ç»„â€      |
| å·®åˆ†æ•°ç»„ï¼ˆå‰ç¼€å’Œçš„é€†æ“ä½œï¼‰ | ç”¨äºå¿«é€ŸåŒºé—´æ›´æ–°          |
| äºŒç»´å‰ç¼€å’Œ         | ç”¨äºå¤„ç†çŸ©é˜µä¸­çš„å­çŸ©é˜µæ±‚å’Œ     |

---

### Pythonå®ç°

```python
# åŸå§‹æ•°ç»„
nums = [3, 2, 4, 5, 1]

# æ„é€ å‰ç¼€å’Œæ•°ç»„
prefix = [0] * (len(nums) + 1)
for i in range(1, len(prefix)):
    prefix[i] = prefix[i-1] + nums[i-1]

# æŸ¥è¯¢åŒºé—´ [1, 3] çš„å’Œ
# å³ nums[1] + nums[2] + nums[3] = 2 + 4 + 5 = 11
l, r = 1, 3
print(prefix[r+1] - prefix[l])  # è¾“å‡º 11
```

---

### ç»å…¸ä¾‹é¢˜
- [560. å’Œä¸º K çš„å­æ•°ç»„](https://leetcode.cn/problems/subarray-sum-equals-k/)
- [303. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜](https://leetcode.cn/problems/range-sum-query-immutable/)

---

## å·®åˆ†æ•°ç»„

å·®åˆ†æ•°ç»„æ˜¯ä¸€ç§ç”¨äºå¿«é€Ÿå¤„ç†åŒºé—´ä¿®æ”¹çš„æŠ€å·§ï¼Œç‰¹åˆ«é€‚åˆé¢‘ç¹è¿›è¡ŒåŒºé—´åŠ æ³•æ“ä½œçš„é—®é¢˜ã€‚ç›¸æ¯”å‰ç¼€å’Œï¼Œå®ƒæ˜¯â€œé€†æ“ä½œâ€ï¼Œé€‚åˆä¿®æ”¹è€Œä¸æ˜¯æŸ¥è¯¢ã€‚

### è®¾è®¡æ€è·¯

è€ƒè™‘æ•°ç»„ $a=[1,3,3,5,8]$ï¼Œå¯¹å…¶ä¸­çš„ç›¸é‚»å…ƒç´ ä¸¤ä¸¤ä½œå·®ï¼ˆå³è¾¹å‡å·¦è¾¹ï¼‰ï¼Œå¾—åˆ°æ•°ç»„ $[2,0,2,3]$ã€‚ç„¶ååœ¨å¼€å¤´è¡¥ä¸Š $a[0]$ï¼Œå¾—åˆ°å·®åˆ†æ•°ç»„ï¼š

$$
d = [1,2,0,2,3]
$$

è¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå¦‚æœä»å·¦åˆ°å³ç´¯åŠ  d ä¸­çš„å…ƒç´ ï¼Œæˆ‘ä»¬å°±ã€Œè¿˜åŸã€å›äº† a æ•°ç»„ $[1,3,3,5,8]$ã€‚

è¿™åˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç°åœ¨æŠŠè¿ç»­å­æ•°ç»„ $a[1]$, $a[2]$, $a[3]$ éƒ½åŠ ä¸Š 10ï¼Œå¾—åˆ° $aâ€²=[1,13,13,15,8]$ ã€‚å†æ¬¡ä¸¤ä¸¤ä½œå·®ï¼Œå¹¶åœ¨å¼€å¤´è¡¥ä¸Š $aâ€²[0]$ï¼Œå¾—åˆ°å·®åˆ†æ•°ç»„ï¼š

$$
dâ€² = [1,12,0,2,âˆ’7]
$$

å¯¹æ¯” $d$ å’Œ $dâ€²$ ï¼Œå¯ä»¥å‘ç°åªæœ‰ $d[1]$ å’Œ $d[4]$ å˜åŒ–äº†ï¼Œè¿™æ„å‘³ç€å¯¹ $a$ ä¸­è¿ç»­å­æ•°ç»„çš„æ“ä½œï¼Œå¯ä»¥è½¬å˜æˆå¯¹å·®åˆ†æ•°ç»„ $d$ ä¸­ä¸¤ä¸ªæ•°çš„æ“ä½œã€‚

---

å¯¹äºæ•°ç»„ $a$, å®šä¹‰å…¶**å·®åˆ†æ•°ç»„ (difference array)** $d$ ä¸º:

$$
d[i] = \begin{cases}
a[0], & i = 0 \\
a[i] - a[i-1], & i \ge 1
\end{cases}
$$

**æ€§è´¨ 1:** ä»å·¦åˆ°å³ç´¯åŠ  $d$ çš„å…ƒç´ , å¯ä»¥å¾—åˆ°æ•°ç»„ $a$ã€‚

**æ€§è´¨ 2:** å¦‚ä¸‹ä¸¤ä¸ªæ“ä½œæ˜¯ç­‰ä»·çš„ã€‚

* æŠŠ $a$ çš„å­æ•°ç»„ $a[i], a[i+1], \dots, a[j]$ éƒ½åŠ ä¸Š $x$ã€‚
* æŠŠ $d[i]$ å¢åŠ  $x$, æŠŠ $d[j+1]$ å‡å°‘ $x$ã€‚

åˆ©ç”¨æ€§è´¨ 2, æˆ‘ä»¬åªéœ€è¦ $O(1)$ çš„æ—¶é—´å°±å¯ä»¥å®Œæˆå¯¹ $a$ çš„å­æ•°ç»„çš„æ“ä½œã€‚æœ€ååˆ©ç”¨æ€§è´¨ 1 ä»å·®åˆ†æ•°ç»„å¤åŸå‡ºæ•°ç»„ $a$ã€‚

**æ³¨:** ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£, $d[i]$ è¡¨ç¤ºæŠŠä¸‹æ ‡ $\ge i$ çš„æ•°éƒ½åŠ ä¸Š $d[i]$ã€‚

![å·®åˆ†æ•°ç»„å›¾ç¤º]({{ site.baseurl }}/assets/images/1747885435-uDDcwT-lc1094-c.png)

**å·®åˆ†æ•°ç»„çš„å¸¸è§åº”ç”¨ï¼š**
* åŒºé—´åŠ æ³•é—®é¢˜
* æ¨¡æ‹Ÿå‰ç¼€å˜åŒ–
* ä¸€ç»´è½¬äºŒç»´çš„â€œäºŒç»´å·®åˆ†â€æŠ€å·§ï¼ˆç”¨äºå¿«é€Ÿå¤„ç†çŸ©å½¢åŒºåŸŸæ›´æ–°ï¼‰

---

### Pythonå®ç°

```python
n = len(nums)
diff = [0] * (n + 1)

# åŒºé—´åŠ æ“ä½œ
def range_add(l, r, val):
    diff[l] += val
    diff[r + 1] -= val  # ä¸æ€•è¶Šç•Œï¼Œå› ä¸ºæœ‰ n+1 é•¿åº¦

# æœ€ç»ˆè¿˜åŸæ•°ç»„
res = [0] * n
res[0] = diff[0]
for i in range(1, n):
    res[i] = res[i - 1] + diff[i]
```

---

## æ ‘çŠ¶æ•°ç»„

æ ‘çŠ¶æ•°ç»„æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼ˆé€šå¸¸ç§°ä¸º `tree` æˆ– `bit`ï¼‰ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯å¯¹åŸå§‹æ•°ç»„çš„å‰ç¼€å’Œè¿›è¡Œâ€œåˆ†å—å‹ç¼©â€ä¿å­˜ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ `O(log n)` çš„æ—¶é—´å†…ï¼š

* **æŸ¥è¯¢æŸä¸ªä½ç½®å‰çš„æ‰€æœ‰æ•°çš„å’Œ**ï¼ˆå‰ç¼€å’Œï¼‰
* **å¿«é€Ÿæ›´æ–°æŸä¸ªä½ç½®çš„å€¼**

å®ƒæ˜¯ **æ•°ç»„çš„ä¸€ç§å¢å¼ºç»“æ„**ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç”¨ç©ºé—´æ¢æ—¶é—´çš„â€œå‰ç¼€å’Œä¼˜åŒ–æ–¹æ¡ˆâ€ã€‚

---

### è®¾è®¡æ€è·¯

**ä¸ºä»€ä¹ˆå«â€œæ ‘çŠ¶â€ï¼Ÿ**

è™½ç„¶ç»“æ„æ˜¯æ•°ç»„ï¼Œå®ƒçš„â€œè·³è·ƒè§„åˆ™â€å°±åƒæ˜¯æ ‘ï¼š
* æ¯ä¸ªä½ç½® i ä»£è¡¨çš„æ˜¯ä¸€ä¸ªåŒºé—´çš„å’Œï¼ˆåŒºé—´å¤§å° = `lowbit(i)`ï¼‰
* åˆ©ç”¨ `lowbit(x)` å¿«é€Ÿè·³è½¬åˆ°çˆ¶åŒºé—´æˆ–å­åŒºé—´ï¼Œå’Œæ ‘éå†ç±»ä¼¼

`lowbit(x)` æ˜¯ä»€ä¹ˆï¼Ÿ
```python
def lowbit(x):
    return x & -x
```

åŠŸèƒ½ï¼šå¾—åˆ° x çš„äºŒè¿›åˆ¶ä¸­æœ€å³ä¾§çš„ `1` æ‰€ä»£è¡¨çš„æ•°å€¼
ä¾‹å¦‚ï¼š

| x  | äºŒè¿›åˆ¶  | lowbit(x) |
| -- | ---- | --------- |
| 6  | 110  | 2         |
| 12 | 1100 | 4         |
| 8  | 1000 | 8         |

---

**ä¸¾ä¸ªä¾‹å­ï¼šæ„å»º BIT ç»“æ„**

è®¾åŸå§‹æ•°ç»„ï¼š`arr = [0, 3, 2, -1, 6, 5, 4, -3]`ï¼ˆä»ä¸‹æ ‡ 1 å¼€å§‹ï¼‰

æ„å»º BIT ç»“æ„ï¼ˆåªè®°å½•åŒºé—´å’Œï¼‰ï¼š

| i | lowbit(i) | ç®¡è¾–çš„å…ƒç´          | tree\[i] å­˜ä»€ä¹ˆ            |
| - | --------- | ------------- | ----------------------- |
| 1 | 1         | \[1]          | arr\[1]                 |
| 2 | 2         | \[1, 2]       | arr\[1] + arr\[2]       |
| 3 | 1         | \[3]          | arr\[3]                 |
| 4 | 4         | \[1, 2, 3, 4] | arr\[1]+...+arr\[4]     |
| 5 | 1         | \[5]          | arr\[5]                 |
| 6 | 2         | \[5, 6]       | arr\[5] + arr\[6]       |
| 7 | 1         | \[7]          | arr\[7]                 |
| 8 | 8         | \[1..8]       | arr\[1] + ... + arr\[8] |

æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå‰ç¼€å—çš„å’Œï¼Œé€šè¿‡ `lowbit(i)` å¿«é€Ÿè·³è½¬ã€‚

---

æ ‘çŠ¶æ•°ç»„æ“…é•¿å¤„ç†ä»¥ä¸‹ç±»å‹é—®é¢˜ï¼š

| ç±»å‹              | ä¸¾ä¾‹                          |
| --------------- | --------------------------- |
| **å‰ç¼€å’Œ / åŒºé—´å’ŒæŸ¥è¯¢** | æŸ¥è¯¢ `[1..r]` æˆ– `[l..r]` åŒºé—´çš„å’Œ |
| **é¢‘ç‡ç»Ÿè®¡ / å‡ºç°æ¬¡æ•°** | å‡ºç°å¤šå°‘ä¸ªå°äºç­‰äº `x` çš„æ•°            |
| **é€†åºå¯¹è®¡æ•°**       | æ¯”æŸæ•°å°çš„å…ƒç´ æœ‰å¤šå°‘ä¸ª                 |
| **åŠ¨æ€ç¬¬ K å°**     | ä½¿ç”¨ BIT äºŒåˆ†æŸ¥æ‰¾ç¬¬ K å¤§/å°          |

---

æ“ä½œæ—¶é—´å¤æ‚åº¦ï¼š

| æ“ä½œ    | æ—¶é—´å¤æ‚åº¦      |
| ----- | ---------- |
| å•ç‚¹ä¿®æ”¹  | `O(log n)` |
| å‰ç¼€å’ŒæŸ¥è¯¢ | `O(log n)` |

ç›¸æ¯”äºå‰ç¼€å’Œæ•°ç»„ `O(1)` æŸ¥è¯¢ä½† `O(n)` æ›´æ–°çš„ç¼ºé™·ï¼Œæ ‘çŠ¶æ•°ç»„åšåˆ°äº†æ›´æ–°ä¸æŸ¥è¯¢éƒ½å¿«ã€‚

---

### Pythonå®ç°
**ä½¿ç”¨ 1-based ä¸‹æ ‡**
```python
class FenwickTree:
    def __init__(self, size):
        # æ ‘çŠ¶æ•°ç»„ä½¿ç”¨ 1-based indexï¼Œå› æ­¤ size = n æ—¶ï¼Œtree å¤§å° = n+1
        self.n = size
        self.tree = [0] * (self.n + 1)

    def lowbit(self, x):
        # è·å–æœ€ä½æœ‰æ•ˆä½ï¼Œä¾‹ï¼š6 -> 2ï¼ˆ0b110 -> 0b10ï¼‰
        return x & -x

    def update(self, index, delta):
        """å°† arr[index] += delta"""
        while index <= self.n:
            self.tree[index] += delta
            index += self.lowbit(index)

    def query(self, index):
        """è¿”å› arr[1] + arr[2] + ... + arr[index] çš„å‰ç¼€å’Œ"""
        result = 0
        while index > 0:
            result += self.tree[index]
            index -= self.lowbit(index)
        return result

    def range_query(self, left, right):
        """è¿”å› arr[left] + ... + arr[right] çš„åŒºé—´å’Œ"""
        return self.query(right) - self.query(left - 1)
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
arr = [2, 3, 5, 1, 4]
n = len(arr)
fenw = FenwickTree(n)

# å¤–éƒ¨æŸ¥è¯¢æˆ–æ›´æ–°å‡½æ•°æ—¶ï¼Œç´¢å¼•éƒ½å¿…é¡»åŠ 1å¤„ç†

# æŒ¨ä¸ªå…ƒç´ æ›´æ–°ï¼Œå³åˆå§‹åŒ–
for i, val in enumerate(arr):
    fenw.update(i + 1, val)  # ç”±äºå†…éƒ¨æ˜¯1-basedå®ç°

# æŸ¥è¯¢åŸæ•°ç»„é—­åŒºé—´[0,2]
print(fenw.query(3))  # è¾“å‡º 10
# æŸ¥è¯¢åŸæ•°ç»„é—­åŒºé—´[1,3]
print(fenw.range_query(2, 4))  # è¾“å‡º 9

# æ›´æ–°ï¼šæŠŠç´¢å¼•2ä½ç½®å…ƒç´ æ›´æ–°ä¸º10ï¼ˆåŸæ¥æ˜¯5ï¼‰
idx = 2
fenw.update(idx+1, 10 - arr[idx])

# å†æŸ¥è¯¢ä¸€æ¬¡ï¼Œå¯çŸ¥æ›´æ–°æœ‰æ•ˆ
print(fenw.query(3))  # è¾“å‡º 15
print(fenw.range_query(2, 4))  # è¾“å‡º 14
```

---

## çº¿æ®µæ ‘

çº¿æ®µæ ‘æ˜¯ä¸€ç§é«˜çº§æ•°æ®ç»“æ„ï¼Œé€‚ç”¨äºé¢‘ç¹çš„åŒºé—´æŸ¥è¯¢å’Œå•ç‚¹/åŒºé—´ä¿®æ”¹é—®é¢˜ã€‚å…¶æœ¬è´¨æ˜¯ä¸€ä¸ªå¹³è¡¡äºŒå‰æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªåŒºé—´çš„ä¿¡æ¯ã€‚

**åº”ç”¨åœºæ™¯ï¼š**
* åŒºé—´å’Œ / åŒºé—´æœ€å¤§å€¼ / åŒºé—´æœ€å°å€¼
* åŒºé—´åŠ å‡ / åŒºé—´èµ‹å€¼ï¼ˆæ‡’æ ‡è®°ï¼‰

---

### è®¾è®¡æ€è·¯

**æ ¸å¿ƒæ€æƒ³ï¼š**

æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªåŒºé—´ `[l, r]`ï¼Œç»´æŠ¤è¿™ä¸ªåŒºé—´çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š
* åŒºé—´å’Œ
* åŒºé—´æœ€å¤§å€¼/æœ€å°å€¼
* åŒºé—´ä¹˜ç§¯/å¼‚æˆ–
* ç”šè‡³æ˜¯å¤æ‚çš„ç»“æ„ï¼ˆæœ€å¤§å‰ç¼€å’Œã€æ‡’æƒ°æ ‡è®°ç­‰ï¼‰


å®ƒå°†æ•°ç»„çš„æ¯ä¸ªå…ƒç´ çœ‹ä½œä¸€ä¸ªåŒºé—´ `[i, i]`ï¼Œä¸æ–­äºŒåˆ†æ„å»ºåŒºé—´æ ‘ï¼Œå¦‚ï¼š
```
åŸæ•°ç»„: nums = [2, 1, 5, 3]

å¯¹åº”åŒºé—´ï¼š
        [0,3]
       /     \
    [0,1]    [2,3]
   /   \     /   \
 [0,0][1,1][2,2][3,3]
```

---

**åŸºæœ¬æ“ä½œè¯¦è§£åŠå¤æ‚åº¦ï¼š**
* å»ºæ ‘ `build`, `O(n)`ï¼šä»åº•å±‚ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰é€’å½’æ„å»ºå‘ä¸Šï¼Œå¸¸ç”¨ DFSã€‚
* æŸ¥è¯¢ `query`, `O(log n)`ï¼šå¦‚æœç›®æ ‡åŒºé—´åŒ…å«åœ¨å½“å‰èŠ‚ç‚¹åŒºé—´ï¼Œè¿”å›å½“å‰èŠ‚ç‚¹å€¼ï¼›å¦åˆ™é€’å½’åˆ°å·¦å³å­æ ‘æŸ¥æ‰¾ã€‚
* æ›´æ–° `update`, `O(log n)`ï¼šä¿®æ”¹æŸä¸ªå…ƒç´ æˆ–åŒºé—´ï¼Œé€’å½’æ›´æ–°å¯¹åº”çš„åŒºé—´ä¿¡æ¯ã€‚


**çº¿æ®µæ ‘ vs æ ‘çŠ¶æ•°ç»„ï¼š**

| é¡¹ç›®    | æ ‘çŠ¶æ•°ç»„  | çº¿æ®µæ ‘    |
| ----- | ----- | ------ |
| æ”¯æŒæ“ä½œ  | åŒºé—´å’Œç±»  | ä»»æ„åŒºé—´ç»Ÿè®¡ |
| åŒºé—´ä¿®æ”¹  | éœ€å˜å½¢æ”¯æŒ | å¯è‡ªç„¶æ”¯æŒ  |
| ç©ºé—´å¤æ‚åº¦ | O(n)  | O(n)   |
| å®ç°å¤æ‚åº¦ | ç®€å•    | è¾ƒå¤æ‚    |
| çµæ´»æ€§   | è¾ƒå·®    | éå¸¸å¼º    |

---

### Pythonå®ç°
**æ— æ‡’æƒ°æ ‡è®°**
```python
class SegmentTree:
    def __init__(self, nums):
        self.n = len(nums)
        self.tree = [0] * (self.n * 4)
        self.build(nums, 0, 0, self.n - 1) # ä»æ ¹èŠ‚ç‚¹ buildï¼ŒåŒºé—´ä¸º [0, n-1]

    def build(self, nums, node, l, r):
        if l == r:
            self.tree[node] = nums[l]  # å¶å­èŠ‚ç‚¹ï¼Œèµ‹å€¼ä¸ºåŸæ•°ç»„ä¸­çš„å…ƒç´ 
        else:
            mid = (l + r) // 2
            # é€’å½’æ„å»ºå·¦å­æ ‘ï¼ˆç¼–å·ï¼š2*node+1ï¼‰ï¼ŒåŒºé—´ï¼š[l, mid]
            self.build(nums, node * 2 + 1, l, mid)
            # é€’å½’æ„å»ºå³å­æ ‘ï¼ˆç¼–å·ï¼š2*node+2ï¼‰ï¼ŒåŒºé—´ï¼š[mid+1, r]
            self.build(nums, node * 2 + 2, mid + 1, r)
            # å½“å‰èŠ‚ç‚¹çš„å€¼ä¸ºå·¦å³å­æ ‘çš„åˆå¹¶ç»“æœï¼ˆæ­¤å¤„ä¸ºåŒºé—´å’Œï¼‰
            self.tree[node] = self.tree[node * 2 + 1] + self.tree[node * 2 + 2]
        
    def update(self, index, val, node=0, l=0, r=None):
        if r is None:
            r = self.n - 1
        if l == r:
            self.tree[node] = val  # æ‰¾åˆ°å¶å­èŠ‚ç‚¹ï¼Œæ›´æ–°å€¼
        else:
            mid = (l + r) // 2
            if index <= mid:
                self.update(index, val, node * 2 + 1, l, mid)
            else:
                self.update(index, val, node * 2 + 2, mid + 1, r)
            # æ›´æ–°å½“å‰èŠ‚ç‚¹çš„å€¼ï¼ˆä»å­æ ‘ä¸­æ›´æ–°ï¼‰
            self.tree[node] = self.tree[node * 2 + 1] + self.tree[node * 2 + 2]

    def query(self, ql, qr, node=0, l=0, r=None):
        if r is None:
            r = self.n - 1
        if ql > r or qr < l:
            return 0  # æŸ¥è¯¢åŒºé—´ä¸å½“å‰åŒºé—´å®Œå…¨ä¸ç›¸äº¤
        if ql <= l and r <= qr:
            return self.tree[node]  # å½“å‰åŒºé—´è¢«æŸ¥è¯¢åŒºé—´å®Œå…¨åŒ…å«ï¼Œç›´æ¥è¿”å›
        mid = (l + r) // 2
        return self.query(ql, qr, node * 2 + 1, l, mid) + \
               self.query(ql, qr, node * 2 + 2, mid + 1, r)
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
arr = [2, 3, 5, 1, 4]

# ç›´æ¥ä¼ å…¥numsï¼Œè¿›è¡Œåˆå§‹åŒ–çº¿æ®µæ ‘
seg_tree = SegmentTree(arr)

# å¤–éƒ¨æŸ¥è¯¢æˆ–æ›´æ–°å‡½æ•°æ—¶ï¼Œç´¢å¼•æ— éœ€é¢å¤–å¤„ç†

# æŸ¥è¯¢åŸæ•°ç»„é—­åŒºé—´[0,2]
print(seg_tree.query(0, 2))  # è¾“å‡º 10
# æŸ¥è¯¢åŸæ•°ç»„é—­åŒºé—´[1,3]
print(seg_tree.query(1, 3))  # è¾“å‡º 9

# æ›´æ–°ï¼šæŠŠç´¢å¼•2ä½ç½®å…ƒç´ æ›´æ–°ä¸º10ï¼ˆåŸæ¥æ˜¯5ï¼‰
seg_tree.update(2, 10)

# å†æŸ¥è¯¢ä¸€æ¬¡ï¼Œå¯çŸ¥æ›´æ–°æœ‰æ•ˆ
print(seg_tree.query(0, 2))  # è¾“å‡º 15
print(seg_tree.query(1, 3))  # è¾“å‡º 14
```

---
