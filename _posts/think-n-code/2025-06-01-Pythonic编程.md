---
title: "Pythonicç¼–ç¨‹æŠ€å·§"
categories: [think-n-code]
tags: [programming]

math: true
layout: post
---

Pythonicï¼ˆç¬¦åˆ Python é£Žæ ¼ï¼‰ çš„æŠ€å·§å¯ä»¥è®©ä»£ç æ›´ç®€æ´ã€ä¼˜é›…ã€é«˜æ•ˆã€‚

| ðŸ­ è¯­æ³•ç³–           | ðŸ’¡ ç¤ºä¾‹                        | ðŸ§µ ç­‰ä»·å†™æ³•ï¼ˆæˆ–ä¼ ç»Ÿå†™æ³•ï¼‰                    |
| ---------------- | ---------------------------- | --------------------------------- |
| **æ¡ä»¶è¡¨è¾¾å¼ï¼ˆä¸‰å…ƒè¡¨è¾¾å¼ï¼‰** | `x = a if cond else b`       | `if cond: x = a else: x = b`      |
| **åˆ—è¡¨æŽ¨å¯¼å¼**        | `[x*x for x in range(5)]`    | ä¼ ç»Ÿ for å¾ªçŽ¯é€ä¸ª `append()`            |
| **å­—å…¸/é›†åˆæŽ¨å¯¼å¼**     | `{x: x*x for x in range(5)}` | ä½¿ç”¨ `for` å’Œ `dict[key] = value`    |
| **å¤šå˜é‡èµ‹å€¼ï¼ˆè§£åŒ…ï¼‰**    | `a, b = 1, 2`                | `a = 1; b = 2`                    |
| **å€¼äº¤æ¢**          | `a, b = b, a`                | ç”¨ä¸´æ—¶å˜é‡ `temp`                      |
| **with ä¸Šä¸‹æ–‡ç®¡ç†å™¨**  | `with open("f.txt") as f:`   | `try-finally` ç»“æž„æ‰‹åŠ¨å…³é—­æ–‡ä»¶            |
| **æžšä¸¾éåŽ†**         | `for i, v in enumerate(lst)` | ä½¿ç”¨ `range(len(lst))` å†è®¿é—® `lst[i]` |
| **zip å¤šåºåˆ—å¹¶è¡ŒéåŽ†**  | `for x, y in zip(a, b)`      | ç”¨ç´¢å¼•é€ä¸ªå–å€¼                           |
| **æ˜Ÿå·è§£åŒ…**         | `a, *rest = [1, 2, 3, 4]`    | æ‰‹åŠ¨åˆ‡ç‰‡                              |
| **å‡½æ•°å‚æ•°è§£åŒ…**       | `f(*args, **kwargs)`         | æ‰‹åŠ¨ä¼ å‚ï¼Œè¾ƒç¹ç                          |
| **è£…é¥°å™¨ @ è¯­æ³•**     | `@decorator`                 | ç­‰ä»·äºŽï¼š`func = decorator(func)`      |
| **lambda è¡¨è¾¾å¼**   | `lambda x: x+1`              | ç”¨ `def` å®šä¹‰å…·åå‡½æ•°                    |

Python çš„è¯­æ³•ç³–è®©ä»£ç æ›´ç¬¦åˆäººç±»æ€ç»´ã€æ›´ç®€æ´æ˜“è¯»ã€‚ä½†ä½¿ç”¨æ—¶è¦æ³¨æ„ï¼š
* å¯è¯»æ€§ä¼˜å…ˆï¼Œé¿å…åµŒå¥—å¤ªå¤šæŽ¨å¯¼å¼æˆ– lambda è¡¨è¾¾å¼
* ç†Ÿæ‚‰ç­‰ä»·å†™æ³•ï¼Œä¾¿äºŽç†è§£åº•å±‚é€»è¾‘

---

### è§£åŒ…
åœ¨ Python ä¸­ï¼Œè§£åŒ…ï¼ˆunpackingï¼‰æ˜¯å°†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ç­‰ï¼‰ä¸­çš„å…ƒç´ èµ‹å€¼ç»™å¤šä¸ªå˜é‡çš„ä¸€ç§ç®€æ´æ–¹å¼ã€‚

---

å·²çŸ¥nums = [1,2,3]ï¼Œé‚£ä¹ˆå°†nums[0]ã€nums[1]ã€nums[2]åˆ†åˆ«èµ‹å€¼ç»™aï¼Œbï¼Œcã€‚è¯¥å¦‚ä½•æ“ä½œï¼Ÿ
```python
nums = [1,2,3]
# æ–¹æ³•ä¸€
a, b, c = *nums # é”™è¯¯
# æ–¹æ³•äºŒ
a, b, c = nums # æ­£ç¡®
```

åœ¨ Python çš„è¯­æ³•è§„åˆ™ä¸­ï¼Œ* è§£åŒ…ç¬¦å·ä¸èƒ½å•ç‹¬å‡ºçŽ°åœ¨èµ‹å€¼å³è¾¹ï¼Œå®ƒåªèƒ½å‡ºçŽ°åœ¨ å‡½æ•°è°ƒç”¨ã€æž„é€ æ–°å®¹å™¨ã€æˆ–èµ‹å€¼å·¦è¾¹ã€‚
```python
# âœ… è¯­æ³•å…è®¸çš„æƒ…å†µ
a, b, c = nums         # âœ… æ­£å¸¸è§£åŒ…
f(*nums)               # âœ… ç”¨åœ¨å‡½æ•°å‚æ•°ä¸­
[a, *b]                # âœ… ç”¨åœ¨åˆ—è¡¨æž„é€ ä¸­
a, *b = nums           # âœ… ç”¨åœ¨èµ‹å€¼å·¦è¾¹

# âŒ éžæ³•
a, b, c = *nums        # âŒ SyntaxError
# SyntaxError: can't use starred expression here
```

Python ä¹‹æ‰€ä»¥é™åˆ¶ï¼Œæ˜¯ä¸ºäº†è¯­æ³•æ¸…æ™°ä¸€è‡´
å› ä¸º a, b, c = *nums å®žé™…ä¸Šç›¸å½“äºŽè¯´ï¼š
>â€œåœ¨å³è¾¹ æŸå¤„ è§£åŒ…æˆå¤šä¸ªå€¼èµ‹å€¼ç»™å·¦è¾¹å˜é‡â€

ä½†è¿™å°±ä¼šå¸¦æ¥ä¸æ¸…æ™°çš„è¾¹ç•Œé—®é¢˜ï¼Œæ¯”å¦‚ï¼š
```python
a, *b = *nums  # é‚£è¿™åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ˜¯è§£ä¸¤æ¬¡ï¼Ÿè¿˜æ˜¯å†è§£åŒ…ç»“æžœï¼Ÿ

# æ‰€ä»¥ Python å¹²è„†ç¦æ­¢åœ¨ èµ‹å€¼å³è¾¹ä½¿ç”¨è£¸ * è§£åŒ…ï¼Œä½ å¿…é¡»ç›´æŽ¥ç”¨ï¼š
a, b, c = nums
```

---

### å¯¹è±¡æŽ’åº

åœ¨ Python ä¸­ï¼Œå¯¹è±¡æŽ’åºå¯ä»¥é€šè¿‡å†…ç½®çš„ `sorted()` å‡½æ•°æˆ– `list.sort()` æ–¹æ³•æ¥å®žçŽ°ã€‚ä½ å¯ä»¥å¯¹ åŸºæœ¬ç±»åž‹ æˆ– è‡ªå®šä¹‰å¯¹è±¡ è¿›è¡ŒæŽ’åºï¼Œå¸¸é…åˆ `key` å‡½æ•°ä½¿ç”¨ã€‚

é™¤äº†ä½¿ç”¨ `key=lambda` çš„æ–¹å¼è¿›è¡ŒæŽ’åºï¼ŒPython ä¹Ÿå…è®¸åœ¨è‡ªå®šä¹‰å¯¹è±¡ä¸­è¦†å†™æ¯”è¾ƒæ–¹æ³•ï¼Œè®©å¯¹è±¡å…·å¤‡åŽŸç”Ÿçš„æŽ’åºèƒ½åŠ›ã€‚

| æ–¹æ³•                | ä¼˜ç‚¹                                 | ç¼ºç‚¹                     |
| ----------------- | ---------------------------------- | ---------------------- |
| `key=lambda`      | ç®€æ´çµæ´»ï¼Œé€‚åˆä¸´æ—¶æŽ’åºé€»è¾‘                      | ä¸å…·å¤‡å¯¹è±¡åŽŸç”Ÿæ¯”è¾ƒèƒ½åŠ›            |
| è¦†å†™ `__lt__` ç­‰æ¯”è¾ƒæ–¹æ³• | è®©å¯¹è±¡æœ¬èº«å¯æ¯”è¾ƒï¼Œå¯ä¸Ž `sorted()`ã€`min()` ç­‰å…¼å®¹ | éœ€è¦æ›´å¤šä»£ç ï¼Œä¸å¤Ÿçµæ´»ï¼ˆä¸é€‚åˆå¤šç§æŽ’åºåœºæ™¯ï¼‰ |


| æƒ…å†µ                   | æ˜¯å¦éœ€è¦ `__eq__`            |
| -------------------- | ------------------------ |
| åªç”¨ `sorted()` æŽ’åº     | å¯ä»¥åªå†™ `__lt__`            |
| æƒ³ä½¿ç”¨ `==`ã€`!=` æ¯”è¾ƒ     | æŽ¨èå†™ `__eq__`             |
| æƒ³è®©å¯¹è±¡åœ¨å®¹å™¨ä¸­æ¯”è¾ƒï¼ˆå¦‚ setï¼‰    | å¿…é¡»å†™ `__eq__`ï¼Œè¿˜éœ€ `__hash__` |

---

### å¡«å……å­—ç¬¦ä¸²

| åç§°                                    | ç”¨é€”                           |
| ------------------------------------- | ---------------------------- |
| `str.zfill(width)`                    | **ä»…ç”¨äºŽæ•°å­—å­—ç¬¦ä¸²**ï¼Œåœ¨å·¦ä¾§å¡«å…… `0`ï¼Œå¸¸ç”¨äºŽè¡¥é›¶ |
| `str.ljust/rjust/center`              | é€šç”¨å­—ç¬¦ä¸²å¡«å……ï¼Œæ”¯æŒè‡ªå®šä¹‰å­—ç¬¦              |

```python
s = "hello"
s1 = s.ljust(10, '*')  # "hello*****"
s2 = s.rjust(10, '*')  # "*****hello"
s3 = s.center(11, '*')  # "***hello***"

s = "42"
s.zfill(5)  # è¾“å‡º: "00042"
```

---

### å‘ä¸Š/ä¸‹å–æ•´

| åŽŸå§‹æ•°å€¼   | `int()` | `math.floor()` | `math.ceil()` |
| ------ | ------- | -------------- | ------------- |
| `3.7`  | `3`     | `3`            | `4`           |
| `-3.7` | `-3`    | `-4`           | `-3`          |

| è¡¨è¾¾å¼          | ç­‰ä»·äºŽ                 | è¯´æ˜Ž        |
| ------------ | ------------------- | --------- |
| `a // b`     | `math.floor(a / b)` | å‘ä¸‹å–æ•´é™¤     |
| `-(-a // b)` | `math.ceil(a / b)`  | å‘ä¸Šå–æ•´é™¤ï¼ˆæŽ¨èï¼‰ |


`-(-a // b)` ä¹‹æ‰€ä»¥èƒ½å¤Ÿå®žçŽ° **å‘ä¸Šå–æ•´**ï¼Œæ˜¯å› ä¸ºå®ƒå·§å¦™åœ°åˆ©ç”¨äº† Python **åœ°æ¿é™¤æ³•**ï¼ˆ`//`ï¼‰çš„è¡Œä¸ºï¼š**â€œå‘ä¸‹å–æ•´â€**ã€‚

> `a // b` æ€»æ˜¯åä½Žä¸€ç‚¹ï¼ˆå¾€è´Ÿæ— ç©·èµ°ï¼‰ã€‚æ‰€ä»¥æƒ³è¦åé«˜ä¸€ç‚¹ï¼ˆå³å‘ä¸Šï¼‰ï¼Œå¯ä»¥å…ˆå¯¹ `a` åŠ ä¸ªè´Ÿå·ï¼Œè¿™æ ·â€œåä½Žâ€åè€Œæ˜¯â€œåé«˜â€
> 
> ç„¶åŽå†å–è´Ÿå›žæ¥ï¼Œå®Œæˆæ–¹å‘è¿˜åŽŸï¼

---

## å¾ªçŽ¯è¯­å¥

### enumerateç”¨æ³•

`enumerate()` æ˜¯ Python å†…ç½®çš„ä¸€ä¸ªéžå¸¸å¸¸ç”¨çš„å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨éåŽ†å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ç­‰ï¼‰æ—¶ï¼Œ**åŒæ—¶èŽ·å–å…ƒç´ çš„ç´¢å¼•å’Œå…ƒç´ æœ¬èº«**ã€‚

```python
enumerate(iterable, start=0)
```

* `iterable`ï¼šéœ€è¦éåŽ†çš„å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²ç­‰ï¼‰ã€‚
* `start`ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºç´¢å¼•çš„èµ·å§‹å€¼ï¼Œé»˜è®¤æ˜¯ `0`ã€‚


æœ€å¸¸è§çš„ç”¨æ³•æ˜¯å°† `enumerate()` ç”¨äºŽ `for` å¾ªçŽ¯ä¸­ï¼Œå®ƒè¿”å›žçš„æ˜¯ä¸€ä¸ªåŒ…å«ç´¢å¼•å’Œå…ƒç´ çš„å…ƒç»„ã€‚
```python
lst = ['a', 'b', 'c']
for index, value in enumerate(lst):
    print(index, value)
```

è¾“å‡ºï¼š

```
0 a
1 b
2 c
```

æŒ‡å®šèµ·å§‹ç´¢å¼•ï¼šä½ å¯ä»¥é€šè¿‡ `start` å‚æ•°æ¥æŒ‡å®šç´¢å¼•çš„èµ·å§‹å€¼ã€‚

```python
lst = ['a', 'b', 'c']
for index, value in enumerate(lst, start=1):
    print(index, value)
```

è¾“å‡ºï¼š

```
1 a
2 b
3 c
```

---

### for elseè¯­æ³•

```python
for item in iterable:
    if condition(item):
        break
else:
    # åªæœ‰å½“ for å¾ªçŽ¯æ²¡æœ‰è¢« break æ‰“æ–­æ—¶ï¼Œè¿™é‡Œçš„ else æ‰ä¼šæ‰§è¡Œ
    do_something()
```

---

**ç†è§£æ–¹å¼**

* `for` å¾ªçŽ¯æ­£å¸¸ç»“æŸï¼ˆæ²¡æœ‰ `break`ï¼‰ï¼Œåˆ™æ‰§è¡Œ `else`ã€‚
* å¦‚æžœ `for` å¾ªçŽ¯å› ä¸º `break` æå‰ç»ˆæ­¢ï¼Œåˆ™ `else` ä¸æ‰§è¡Œã€‚

---

ä¸¾ä¸ªä¾‹å­ï¼šæŸ¥æ‰¾è´¨æ•°

```python
n = 29

for i in range(2, int(n ** 0.5) + 1):
    if n % i == 0:
        print(f"{n} ä¸æ˜¯è´¨æ•°")
        break
else:
    print(f"{n} æ˜¯è´¨æ•°")
```

è§£é‡Šï¼š

* å¦‚æžœ `n` èƒ½è¢«æŸä¸ª `i` æ•´é™¤ï¼Œè¯´æ˜Žä¸æ˜¯è´¨æ•°ï¼Œç›´æŽ¥ `break`ã€‚
* å¦‚æžœ `for` å¾ªçŽ¯è·‘å®Œæ²¡ `break`ï¼Œè¯´æ˜Žæ‰¾ä¸åˆ°å› å­ï¼Œæ˜¯è´¨æ•°ï¼ŒäºŽæ˜¯æ‰§è¡Œ `else`ã€‚

---

### iter/nextç”¨æ³•

`iter()` å’Œ `next()` åœ¨ Python ä¸­æ˜¯æž„å»º **è¿­ä»£å™¨æ¨¡å¼** çš„æ ¸å¿ƒï¼Œå¾ˆå¤šçœ‹ä¼¼â€œè‡ªåŠ¨â€çš„è¯­æ³•ç³–ï¼ˆæ¯”å¦‚ `for` å¾ªçŽ¯ã€ç”Ÿæˆå™¨ï¼‰å…¶å®žèƒŒåŽéƒ½ç”¨åˆ°å®ƒä»¬ã€‚

---

**åº•å±‚åŽŸç†**

è™½ç„¶æˆ‘ä»¬å¹³æ—¶å†™ï¼š

```python
for x in [1, 2, 3]:
    print(x)
```

ä½†å…¶å®žç­‰ä»·äºŽï¼š

```python
it = iter([1, 2, 3])  # èŽ·å–è¿­ä»£å™¨
while True:
    try:
        x = next(it)  # å–ä¸‹ä¸€ä¸ªå…ƒç´ 
        print(x)
    except StopIteration:
        break
```

---

**å¸¸ç”¨åœºæ™¯ï¼š**

**æ‰‹åŠ¨æŽ§åˆ¶è¿­ä»£è¿‡ç¨‹**

å½“ä½ ä¸æƒ³ç”¨ `for`ï¼Œè€Œæ˜¯ä¸€æ­¥æ­¥èŽ·å–æ•°æ®æ—¶ï¼š

```python
nums = [10, 20, 30]
it = iter(nums)

print(next(it))  # 10
print(next(it))  # 20
# å¯ä»¥éšæ—¶åœä¸‹æ¥
```

> ç”¨å¤„ï¼šé€æ­¥è°ƒè¯•ã€åœ¨éœ€è¦æƒ°æ€§å–å€¼çš„åœºæ™¯ï¼ˆæ¯”å¦‚æµå¼æ•°æ®å¤„ç†ï¼‰ã€‚

---

**ä»Žæµ/æ–‡ä»¶ä¸­é€è¡Œè¯»å–ï¼ˆæ‡’åŠ è½½ï¼‰**

```python
with open("data.txt") as f:
    it = iter(f)   # æ–‡ä»¶å¯¹è±¡æœ¬èº«å°±æ˜¯è¿­ä»£å™¨
    for line in it:
        print(line.strip())
```

> ç”¨å¤„ï¼šå¤§æ–‡ä»¶å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ã€‚

---

**`iter(callable, sentinel)` æ¨¡å¼**

```python
# ä»Žè¾“å…¥è¯»å–ï¼Œç›´åˆ°é‡åˆ° "quit"
it = iter(input, "quit")
for line in it:
    print("è¾“å…¥ï¼š", line)
```

> ç”¨å¤„ï¼š**ä»£æ›¿ while True + break**ï¼Œåœ¨â€œè¯»åˆ°æŸä¸ªç»ˆæ­¢å€¼æ—¶åœæ­¢â€ã€‚

---

**ç”Ÿæˆå™¨è¡¨è¾¾å¼ + `next()`ï¼ˆå¿«é€Ÿå–å€¼ï¼‰**

```python
nums = [0, 4, 0, 5, 6]

first_nonzero = next(x for x in nums if x != 0)
print(first_nonzero)  # 4
```

> ç”¨å¤„ï¼šä»Žåºåˆ—é‡Œå¿«é€Ÿæ‰¾åˆ°**ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å€¼**ã€‚

---

**`next(it, default)` é˜²æ­¢å¼‚å¸¸**

```python
it = iter([1, 2])
print(next(it, None))  # 1
print(next(it, None))  # 2
print(next(it, None))  # None (ä¸ä¼šæŠ› StopIteration)
```

> ç”¨å¤„ï¼šæƒ³å®‰å…¨å–å€¼ï¼Œä¸æƒ³å†™ try/exceptã€‚

---

### count(1)ç”¨æ³•

ä½ é—®çš„ `count(1)` æ˜¯ **`itertools.count(1)`**ï¼Œå®ƒä¸æ˜¯å†…ç½®å‡½æ•°ï¼Œè€Œæ˜¯ Python æ ‡å‡†åº“ `itertools` æä¾›çš„ä¸€ä¸ªå·¥å…·ã€‚

---

åŸºæœ¬ç”¨æ³•

```python
from itertools import count

for i in count(1):
    print(i)
    if i > 5:
        break
```

è¾“å‡ºï¼š

```
1, 2, 3, 4, 5, 6
```

`count(start, step=1)` ä¼šè¿”å›žä¸€ä¸ª **æ— é™è¿­ä»£å™¨**ï¼š

* `start`ï¼šèµ·å§‹å€¼ï¼ˆæ¯”å¦‚ `1`ï¼‰ã€‚
* `step`ï¼šæ­¥é•¿ï¼ˆé»˜è®¤ä¸º `1`ï¼‰ã€‚

---

**å¸¦æ­¥é•¿çš„ç”¨æ³•**

```python
from itertools import count

for i in count(10, 2):  # ä»Ž10å¼€å§‹ï¼Œæ¯æ¬¡+2
    print(i)
    if i > 20:
        break
```

è¾“å‡ºï¼š

```
10, 12, 14, 16, 18, 20, 22
```

---
