---
title: "单调栈：数据结构里的“递增/递减利器”"
categories: [02_DataStructures]
tags: [stack]

math: true
layout: post
---

单调栈（Monotonic Stack）是一种维护栈内元素单调性的结构，常用于在 O(n) 时间内解决“下一个更大/更小元素”类问题。

---

### 基本介绍

单调栈是指栈内元素单调递增或递减的栈结构。

**常见应用场景：**

| 应用场景      | 简要描述                     |
| --------- | ------------------------ |
| 下一个更大元素（或更小元素） | 从一个数组中找到每个元素右边第一个比它大的数   |
| 柱状图中最大的矩形 | 求解每根柱子左右第一个比它矮的柱子，计算最大面积 |
| 滑动窗口最值    | 单调队列变形                   |
| 某个元素的左/右边界 | 找到数组中每个元素左边第一个比它小/大的数    |

**单调递增（递减）栈：**

| 类型    | 特点                | 适用场景                |
| ----- | ----------------- | ------------------- |
| 单调递增栈 | 栈内元素从栈底到栈顶递增（小→大） | 寻找**下一个更小元素**、维护最小值 |
| 单调递减栈 | 栈内元素从栈底到栈顶递减（大→小） | 寻找**下一个更大元素**、维护最大值 |

**举例说明：**
以数组 `[2, 1, 5, 6, 2, 3]` 为例，**寻找每个元素右侧第一个比它大的元素**，若不存在，则记为 -1。

维护一个 **单调递减栈**，栈中存的是**索引**。遍历数组时，如果当前元素比栈顶对应的元素大，就说明找到了“下一个更大的元素”。

---

### 算法过程

输入数组：`nums = [2, 1, 5, 6, 2, 3]`

遍历过程：

1. i = 0, nums\[0] = 2
   → 栈空，入栈 \[0]

2. i = 1, nums\[1] = 1
   → 栈顶 nums\[0]=2 > 1，不满足条件，入栈 \[0, 1]

3. i = 2, nums\[2] = 5

   * 栈顶 nums\[1]=1 < 5 → 弹出，res\[1] = 5
   * 栈顶 nums\[0]=2 < 5 → 弹出，res\[0] = 5
     → 入栈 \[2]

4. i = 3, nums\[3] = 6

   * 栈顶 nums\[2]=5 < 6 → 弹出，res\[2] = 6
     → 入栈 \[3]

5. i = 4, nums\[4] = 2
   → 栈顶 nums\[3]=6 > 2，不弹出，入栈 \[3, 4]

6. i = 5, nums\[5] = 3

   * 栈顶 nums\[4]=2 < 3 → 弹出，res\[4] = 3
     → 栈顶 nums\[3]=6 > 3，不弹出，入栈 \[3, 5]

最终结果：`res = [5, 5, 6, -1, 3, -1]`

---

### Python 实现

```python
def next_greater(nums):
    res = [-1] * len(nums)
    stack = []
    for i, num in enumerate(nums):
        while stack and nums[i] > nums[stack[-1]]:
            idx = stack.pop()
            res[idx] = nums[i]
        stack.append(i)
    return res
```

### 经典例题

| 题号   | 题目                                                                                           | 标签                |
| ---- | -------------------------------------------------------------------------------------------- | ----------------- |
| 496  | [下一个更大元素 I](https://leetcode.cn/problems/next-greater-element-i/)                            | 模板题         |
| 503  | [下一个更大元素 II](https://leetcode.cn/problems/next-greater-element-ii/)                          | 循环数组 / 模板题  |
| 84   | [柱状图中最大的矩形](https://leetcode.cn/problems/largest-rectangle-in-histogram/)                    | 最大面积 / 模板题  |
| 42   | [接雨水](https://leetcode.cn/problems/trapping-rain-water/)                                     | 双指针 / 模板题   |
| 239  | [滑动窗口最大值](https://leetcode.cn/problems/sliding-window-maximum/)                              | 单调队列 / 滑动窗口 / 模板题 |
| 3542 | [将所有元素变为 0 的最少操作次数](https://leetcode.cn/problems/minimum-operations-to-convert-all-elements-to-zero/) | 单调栈 / 思维题 |

---
