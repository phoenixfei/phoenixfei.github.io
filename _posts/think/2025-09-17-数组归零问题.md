---
title: "数组归零问题：最少操作次数的数学公式与证明"
categories: [think]
tags: [math]

math: true
layout: post
---

将数组所有元素降至 `≤0` 的最小操作次数 — 题目、答案与证明。

---

## 题目（标准化描述）

给定一个由非负整数构成的一维数组 $a=[a_1,a_2,\dots,a_n]$（$a_i \in \mathbb{Z}_{\ge0}$）。一次操作要求：选择**两个不同下标** $i \ne j$，并将这两个元素各减 1，即执行

$$
a_i \leftarrow a_i - 1, \qquad a_j \leftarrow a_j - 1.
$$

问：要使数组中所有元素都 **小于等于 0**（即对每个 $k$ 有 $a_k \le 0$），最少需要多少次操作？请给出答案并证明。

---

## 答案（结论）

设数组总和为

$$
S = \sum_{i=1}^{n} a_i,
$$

最大元素为

$$
M = \max_{1 \le i \le n} a_i.
$$

则所需最少操作次数为：

$$
\boxed{T = \max\Big(M, \lceil S/2 \rceil \Big)}.
$$

---

## 证明

记最少所需操作次数为 $T$。

### 1. 下界（任意策略都不能少于它）

* **单点约束**：每次操作对任意固定下标最多减少 1，要把最大元素 $M$ 降到 $\le0$，至少需要 $M$ 次。因此

$$
T \ge M.
$$

* **总和约束**：每次操作把数组总和减少 2（两个元素各减 1）。初始总和为 $S$，要使最终所有元素都 $\le0$，总和必须变为 $\le0$。若用 $T$ 次操作，总和变为 $S - 2T \le 0$，所以

$$
T \ge \lceil S/2 \rceil.
$$

综合两者得下界：

$$
T \ge \max\Big(M, \lceil S/2 \rceil \Big).
$$

---

### 2. 上界（存在策略能在该次数内完成）

只需给出构造性策略，使操作次数不超过

$$
t := \max\Big(M, \lceil S/2 \rceil \Big).
$$

分两种情况讨论：

#### 情形 A：$M \le \lceil S/2 \rceil$

把每个单位看作一个 token（共有 $S$ 个 token，分布在若干堆，堆大小即为各 $a_i$）。由于 $M \le \lceil S/2 \rceil$，不可能只有一堆为正。每步选择两个正数的下标各减 1（优先选择当前最大两个），重复直到所有元素 $\le0$。

总共需要 $\lceil S/2 \rceil$ 步，且 $\lceil S/2 \rceil \ge M$，因此可在 $t$ 步内完成。

#### 情形 B：$M > \lceil S/2 \rceil$

令目标次数取 $t = M$。每步选择最大元素所在下标与任意其他不同下标进行操作，每步把最大元素减 1，并同时把另一个下标减 1。经过 $M$ 步后，最大元素降至 $\le0$，同时总和满足 $S - 2M \le 0$，因此所有元素均 $\le0$。

---

### 3. 结论

由下界与上界匹配，最少操作次数恰为

$$
T = \max\Big(M, \lceil S/2 \rceil \Big).
$$

---

## 示例

对 $a = [1, 3, 4, 2, 5, 7]$：

* $S = 1 + 3 + 4 + 2 + 5 + 7 = 22$ → $\lceil S/2 \rceil = 11$
* $M = 7$

因此

$$
T = \max(7, 11) = 11 \text{ 次}.
$$

---

## 补充（构造性操作策略提示）

* 情形 A ($M \le \lceil S/2 \rceil$)：每次选择当前两个最大正元素下标进行操作，最后可能和 0 元素配对。
* 情形 B ($M > \lceil S/2 \rceil$)：每次都选择最大元素下标和任意其他下标进行操作即可。

这两种策略都能在理论上给出实际操作序列。
